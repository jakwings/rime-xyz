# ------------------------------------------------------------------------------
# Rime schema
# encoding: utf-8
# ------------------------------------------------------------------------------
# Copyright (c) 2016 Jak Wings https://github.com/jakwings/rime-xyz
#
# Permission to use, copy, modify, and/or distribute this software for any
# purpose with or without fee is hereby granted, provided that the above
# copyright notice and this permission notice appear in all copies.
#
# THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
# REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
# AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
# INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
# LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
# OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
# PERFORMANCE OF THIS SOFTWARE.
# ------------------------------------------------------------------------------

schema:
  version: '2016.8.5'
  schema_id: &id muddy-pinyin
  name: 泥巴拼音
  author:
    - Jak Wings #!@Gmail.com
  description: |
    該方案借用「地球拼音」碼表。專爲查詞典而設計。
    突出介音；區分 a/ê、e/ê、o/u、o/uo、u/ü。
    可略聲母、韻母、音調。可配全音節專用隔音符："
    平上去入輕略：- / < \ > *

    例如，輸入 hao<*"hao<*i (hɑ̌o …" hɑ̌o …i) 索得：
    * 好人好事（hɑ̌o rén hɑ̌o ŝì）
    * 好心好意（hɑ̌o xīn hɑ̌o yì）
    * 好聲好氣（hɑ̌o ŝēŋ hɑ̌o qì）
  dependencies:
    - terra_pinyin

switches:
  - name: ascii_mode
    reset: 0
    states: [ 中文, 西文 ]
  - name: full_shape
    states: [ 半角, 全角 ]
  - name: simplification
    states: [ 漢字, 汉字 ]
  - name: gbk
    states: [ 增廣, GBK ]
  - name: ascii_punct
    states: [ 。，, ．， ]

engine:
  processors:
    - ascii_composer
    - key_binder
    - selector
    - navigator
    - recognizer
    - speller
    - punctuator
    - express_editor
  segmentors:
    - ascii_segmentor
    - matcher
    - abc_segmentor
    - punct_segmentor
    - fallback_segmentor
  translators:
    - punct_translator
    - script_translator
  filters:
    - simplifier
    - charset_filter@gbk

speller:
  alphabet: 'zyxwvutsrqponmlkjihgfedcba-/<\>*"'
  delimiter: " '"
  algebra:
    # ※
    - xform/\d/:$&/
    # 略音調
    - derive/:\d//
    # 區分 e/ê
    - xform/eh\>/ie/
    # 區分 o/uo
    - derive/^([bfmp])o\>/$1uo/
    # 區分 u/ü
    - xform/^([jqxy])u/$1v/
    # 區分 o/u
    - derive/ong\>/ung/
    # 區分 a/ê
    - derive/([iv]|^y)an\>/$1en/
    # 兒音
    - xform/^r\>/er/
    # 介音
    - derive/iu\>/iou/
    - derive/ui\>/uei/
    - derive/un\>/uen/
    # 隔音符
    - derive/$/"/
    # 略音節
    - derive/^[^"]+"$/*"/
    # 略韻母
    - derive/^[aeiouv][a-z]*\>/*/
    - derive/^([csz]h|[a-z])[a-z]+\>/$1*/
    # 略聲母
    - derive/^(?:zh|sh|ch|[bcdfghjklmnpqrstwxz])([a-z]+)\>/*$1/
    - derive/^w([a-z]+)\>/*u$1/
    - xform/^\*uu/*u/
    - derive/^y(?!(?:en?|an)\>)([a-z]+)\>/*$1/
    - derive/^y([a-z]+)\>/*i$1/
    - xform/^\*ii/*i/
    - derive/^\*ve\>/*ue/
    # 簡拼
    - fuzz/^([a-z])[a-z]+\>/$1/
    - fuzz/^([zcs]h)[a-z]+\>/$1/
    # 兼容
    - derive/^([jqxy])v/$1u/
    # 聲調
    - xlit 12345 -/<\>
    # ※
    - xform/://

translator:
  dictionary: *id
  prism: *id
  spelling_hints: 5  # 幾個字以內提示拼音
  enable_sentence: true  # 是否自動造句
  enable_user_dict: true  # 是否記錄生詞並自動調頻
  enable_charset_filter: true
  preedit_format: &format  # {
    - xlit -/<\>* 12345…
    - xform/\d/:$&;/
    # 特殊拼寫 {
    - xform/\<([bfmp])o\>/$1uo/
    - xform/\<([ln]?)ue\>/$1vE/
    - xform/\<([jqxy])u([en]|[ae]n)?\>/$1v$2/
    - xform/([iv]|\<y)[ae]n\>/$1En/
    - xform/\<ye/yE/
    - xform/([iv])e\>/$1E/
    - xform/eh\>/iE/
    - xform/ong\>/ung/
    - xform/iu\>/iou/
    - xform/ui\>/uei/
    - xform/un\>/uen/
    # 特殊拼寫 }
    # 聲調定位 {
    - xform/([aeo])([aeiouv][a-z]*):(\d)/$1$3$2/
    - xform/([iuv][aeiouv])([a-z]*):(\d)/$1$3$2/
    - xform/([aeiouvE])([a-z]*):(\d)/$1$3$2/
    # 聲調定位 }
    # 組合性聲調符號 {
    - "xform/([aeiouvE*]|\\<(?:[bcdfghjklmnpqrstwxyz])):?1/$1\u0304/"
    - "xform/([aeiouvE*]|\\<(?:[bcdfghjklmnpqrstwxyz])):?2/$1\u0301/"
    - "xform/([aeiouvE*]|\\<(?:[bcdfghjklmnpqrstwxyz])):?3/$1\u030C/"
    - "xform/([aeiouvE*]|\\<(?:[bcdfghjklmnpqrstwxyz])):?4/$1\u0300/"
    - "xform/([aeiouvE*]|\\<(?:[bcdfghjklmnpqrstwxyz])):?5/$1\u0307/"
    # 組合性聲調符號 }
    # 特殊拼寫 {
    - xform/\<ch/ĉ/
    - xform/\<sh/ŝ/
    - xform/\<zh/ẑ/
    - xform/ng\>/ŋ/
    - xlit agvE ɑɡüê
    # 特殊拼寫 }
    # 雙字符組合變單字符 {
    - "xform/a\u0304/ā/"
    - "xform/a\u0301/á/"
    - "xform/a\u030C/ǎ/"
    - "xform/a\u0300/à/"
    - "xform/e\u0304/ē/"
    - "xform/e\u0301/é/"
    - "xform/e\u030C/ě/"
    - "xform/e\u0300/è/"
    - "xform/i\u0304/ī/"
    - "xform/i\u0301/í/"
    - "xform/i\u030C/ǐ/"
    - "xform/i\u0300/ì/"
    - "xform/o\u0304/ō/"
    - "xform/o\u0301/ó/"
    - "xform/o\u030C/ǒ/"
    - "xform/o\u0300/ò/"
    - "xform/u\u0304/ū/"
    - "xform/u\u0301/ú/"
    - "xform/u\u030C/ǔ/"
    - "xform/u\u0300/ù/"
    - "xform/ü\u0304/ǖ/"
    - "xform/ü\u0301/ǘ/"
    - "xform/ü\u030C/ǚ/"
    - "xform/ü\u0300/ǜ/"
    # 雙字符組合變單字符 }
    - xform/[:;]//
    - xlit 12345 ˉˊ˅ˋ˙
  # }
  comment_format: *format

key_binder:
  import_preset: default

punctuator:
  import_preset: default

recognizer:
  import_preset: default
