# ------------------------------------------------------------------------------
# Rime schema
# encoding: utf-8
# ------------------------------------------------------------------------------
# Copyright (c) 2016 Jak Wings https://github.com/jakwings/rime-xyz
#
# This file uses the same GPLv3 license as terra_pinyin.dict.yaml from:
# https://github.com/rime/brise/blob/master/LICENSE
# Also see:
# https://github.com/jakwings/rime-xyz/blob/master/license/GPLv3.txt
# ------------------------------------------------------------------------------

schema:
  version: "2016.7.29"
  schema_id: &id muddy-pinyin
  name: 泥巴拼音
  author:
    - Jak Wings #!@Gmail.com
  description: |
    該方案借用「地球拼音」碼表。專爲查詞典而設計。
    突出介音；區分 a/ê、e/ê、o/u、o/uo、u/ü。
    可略聲母、韻母、音調。可配全音節專用隔音符："
    平上去入輕略：- / < \ > *

    例如，輸入 `hao<*"hao<*i`（hɑ̌o …" hɑ̌o …i）索得：
    * 好人好事（hɑ̌o rén hɑ̌o ŝì）
    * 好心好意（hɑ̌o xīn hɑ̌o yì）
    * 好聲好氣（hɑ̌o ŝēŋ hɑ̌o qì）
  dependencies:
    - terra_pinyin

switches:
  - name: ascii_mode
    reset: 0
    states: [ 中文, 西文 ]
  - name: full_shape
    states: [ 半角, 全角 ]
  - name: simplification
    states: [ 漢字, 汉字 ]
  - name: gbk
    states: [ 增廣, GBK ]
  - name: ascii_punct
    states: [ 。，, ．， ]

engine:
  processors:
    - ascii_composer
    - key_binder
    - selector
    - navigator
    - recognizer
    - speller
    - punctuator
    - express_editor
  segmentors:
    - ascii_segmentor
    - matcher
    - abc_segmentor
    - punct_segmentor
    - fallback_segmentor
  translators:
    - punct_translator
    - script_translator
  filters:
    - simplifier
    - charset_filter@gbk
    #- uniquifier

speller:
  alphabet: 'zyxwvutsrqponmlkjihgfedcba-/<\>*"'
  delimiter: " '"
  algebra:
    # 略音調
    - derive/[1-5]$//
    # 區分 e/ê
    - xform/eh(\d?)$/ie$1/
    - derive/^ye(\d?)$/yie$1/
    # 區分 o/uo
    - derive/^([bfmpw])o(\d?)$/$1uo$2/
    # 區分 u/ü
    - xform/^([jqxy])u/$1v/
    # 區分 o/u
    - derive/ong(\d?)$/ung$1/
    # 區分 a/ê
    - derive/([ivy])an(\d?)$/$1en$2/
    # 兒音
    - xform/^r(\d?)$/er$1/
    # 介音
    - derive/iu(\d?)$/iou$1/
    - derive/ui(\d?)$/uei$1/
    - xform/un(\d?)$/uen$1/
    - derive/^w([ao]|[ae]i|[ae]ng?)(\d?)$/wu$1$2/
    - derive/^y([ao]|[aeou]ng?|a[io]|ou)(\d?)$/yi$1$2/
    # 隔音符
    - derive/$/"/
    # 略音節
    - abbrev/^[^"]+"$/*"/
    # 略韻母
    - abbrev/^[aeiouv][a-z]*(\d?"?)$/*$1/
    - abbrev/^(zh|sh|ch|[a-z])[a-z]+(\d?"?)$/$1*$2/
    # 略聲母
    - abbrev/^(?:zh|sh|ch|[bcdfghjklmnpqrstwxz])([a-z]+\d?"?)$/*$1/
    - abbrev/^y(?!(?:en?|an)\d?"?$)([a-z]+\d?"?)$/*$1/
    # 簡拼
    - fuzz/^(zh|sh|ch|[a-z])[a-z]+(\d?)$/$1$2/
    # 兼容
    - derive/^([jqxy])v/$1u/
    - derive/uen(\d?"?)$/un$1/
    # 聲調
    - xlit 12345 -/<\>

translator:
  dictionary: *id
  prism: *id
  spelling_hints: 5  # 幾個字以內提示拼音
  enable_sentence: true  # 是否自動造句
  enable_user_dict: true  # 是否自動調頻
  enable_charset_filter: true
  preedit_format: &format  #{
    - xlit -/<\>* 12345…
    - xform/\d/:$&;/
    # 特殊拼寫 {
    - xform/\<([nl])ue/$1ve/
    - xform/\<([jqxy])u/$1v/
    - xform/\<([bfmp])o/$1uo/
    - xform/ong\>/ung/
    - xform/([ivy])an\>/$1en/
    - xform/iu\>/iou/
    - xform/ui\>/uei/
    - xform/un\>/uen/
    - xform/\<(y|[^y][iv])[ae]n\>/$1ien/
    - xform/\<ye\>/yie/
    - xform/ve\>/vie/
    - xform/eh\>/ie/
    # 特殊拼寫 }
    # 聲調定位 {
    - xform/([aeiouv]ie)([^' ]*?):([1-5])/$1$3$2/
    - xform/([aeo])([aeiouv][^' ]*?):([1-5])/$1$3$2/
    - xform/([iuv][aeiouv])([^' ]*?):([1-5])/$1$3$2/
    - xform/([aeiouv])([^' ]*?):([1-5])/$1$3$2/
    # 聲調定位 }
    # 組合性聲調符號 {
    - "xform/([aeiouv*]|\\<(?:[bcdfghjklmnpqrstwxyz])):?1/$1\u0304/"
    - "xform/([aeiouv*]|\\<(?:[bcdfghjklmnpqrstwxyz])):?2/$1\u0301/"
    - "xform/([aeiouv*]|\\<(?:[bcdfghjklmnpqrstwxyz])):?3/$1\u030C/"
    - "xform/([aeiouv*]|\\<(?:[bcdfghjklmnpqrstwxyz])):?4/$1\u0300/"
    - "xform/([aeiouv*]|\\<(?:[bcdfghjklmnpqrstwxyz])):?5/$1\u0307/"
    # 組合性聲調符號 }
    # 特殊拼寫 {
    - xform/([aeiouvy])ie/$1ê/
    - xform/ie/iê/
    - xform/\<ch/ĉ/
    - xform/\<sh/ŝ/
    - xform/\<zh/ẑ/
    - xform/ng\>/ŋ/
    - xlit agv ɑɡü
    # 特殊拼寫 }
    # 雙字符組合變單字符 {
    - "xform/a\u0304/ā/"
    - "xform/a\u0301/á/"
    - "xform/a\u030C/ǎ/"
    - "xform/a\u0300/à/"
    - "xform/e\u0304/ē/"
    - "xform/e\u0301/é/"
    - "xform/e\u030C/ě/"
    - "xform/e\u0300/è/"
    - "xform/i\u0304/ī/"
    - "xform/i\u0301/í/"
    - "xform/i\u030C/ǐ/"
    - "xform/i\u0300/ì/"
    - "xform/o\u0304/ō/"
    - "xform/o\u0301/ó/"
    - "xform/o\u030C/ǒ/"
    - "xform/o\u0300/ò/"
    - "xform/u\u0304/ū/"
    - "xform/u\u0301/ú/"
    - "xform/u\u030C/ǔ/"
    - "xform/u\u0300/ù/"
    - "xform/ü\u0304/ǖ/"
    - "xform/ü\u0301/ǘ/"
    - "xform/ü\u030C/ǚ/"
    - "xform/ü\u0300/ǜ/"
    # 雙字符組合變單字符 }
    - xform/[:;]//
    - xlit 12345 ˉˊ˅ˋ˙
  # }
  comment_format: *format

key_binder:
  import_preset: default

punctuator:
  import_preset: default

recognizer:
  import_preset: default
